# TV Downloader - Загрузчик видео из Telegram каналов

Бот для массовой загрузки видеофайлов из Telegram каналов с поддержкой параллельных загрузок и автоматическим выбором качества.

## Возможности

- ✅ Массовая загрузка видео из одного или нескольких каналов
- ✅ Параллельная загрузка нескольких файлов одновременно
- ✅ Автоматический выбор качества видео (360p, 480p, 720p)
- ✅ Организация файлов по каналам
- ✅ Проверка дубликатов (не скачивает уже загруженные файлы)
- ✅ Уведомления в Telegram о прогрессе и завершении
- ✅ Сохранение метаданных о скачанных файлах
- ✅ Обработка ошибок с повторными попытками
- ✅ Поддержка публичных каналов, приватных каналов и invite links

## Требования

- Python 3.8 или выше
- Telegram API credentials (API ID и API Hash)
- Токен Telegram бота для уведомлений (опционально)

## Установка

1. Клонируйте репозиторий или скачайте файлы проекта

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте конфигурацию:
   - Скопируйте `config/config.example.yaml` в `config/config.yaml`
   - Заполните своими данными:
     - `api_id` и `api_hash` (получите на https://my.telegram.org/apps)
     - `bot_token` и `chat_id` для уведомлений
     - Список каналов для скачивания

## Конфигурация

### Получение API credentials

1. Перейдите на https://my.telegram.org/apps
2. Войдите с вашим номером телефона
3. Создайте приложение (если еще не создано)
4. Скопируйте `api_id` и `api_hash`

### Создание бота для уведомлений

1. Найдите @BotFather в Telegram
2. Отправьте `/newbot` и следуйте инструкциям
3. Сохраните токен бота
4. Получите ваш Chat ID (напишите боту и используйте getUpdates API)

### Настройка каналов

В конфигурации можно указать каналы в разных форматах:
- Username: `@channel_name`
- Invite link: `https://t.me/joinchat/...`
- Channel ID: `-1001234567890`

Пример:
```yaml
channels:
  - "@channel_name"
  - "https://t.me/joinchat/AAAAAFZTTF99JzOWLZH74A"
  - -1001234567890
```

## Использование

### Первый запуск

При первом запуске вам потребуется:
1. Ввести номер телефона
2. Ввести код подтверждения из Telegram

После этого сессия сохранится в папке `sessions/` и код больше не понадобится.

### Запуск

```bash
python -m src.main
```

или

```bash
python src/main.py
```

### Что происходит при запуске

1. Подключение к Telegram API
2. Сканирование указанных каналов
3. Фильтрация видео по качеству (360p, 480p, 720p)
4. Проверка, какие файлы уже скачаны
5. Параллельная загрузка новых файлов
6. Сохранение метаданных
7. Отправка уведомлений (если включено)

## Структура проекта

```
TVDownloader/
├── config/
│   ├── config.example.yaml    # Пример конфигурации
│   └── config.yaml             # Ваша конфигурация (не в git)
├── src/
│   ├── __init__.py
│   ├── telegram_client.py      # Клиент Telegram API
│   ├── download_manager.py     # Менеджер загрузок
│   ├── file_handler.py         # Обработка файлов
│   ├── video_quality.py        # Выбор качества видео
│   ├── notifier.py             # Уведомления
│   └── main.py                 # Главный скрипт
├── downloads/                  # Скачанные файлы
│   └── [channel_name]/
├── sessions/                   # Файлы сессий Telegram
├── data/                       # Метаданные
│   └── downloaded_files.json
├── logs/                       # Логи
├── requirements.txt
└── README.md
```

## Настройки

### Параллелизм

В `config.yaml` можно настроить количество одновременных загрузок:
```yaml
download:
  max_concurrent: 5  # Количество одновременных загрузок
```

### Качество видео

Можно указать, какие качества скачивать:
```yaml
download:
  video_qualities: [360, 480, 720]
  download_nearest_quality: true  # Скачивать ближайшее меньшее, если точного нет
```

### Уведомления

```yaml
notifications:
  enabled: true
  notify_on_completion: true   # Уведомлять при завершении
  notify_on_errors: true        # Уведомлять при ошибках
  notify_on_start: false        # Уведомлять при начале
```

## Логирование

Логи сохраняются в:
- Консоль (всегда)
- Файл (если указан в конфиге): `logs/downloader.log`

Уровень логирования настраивается в конфиге:
```yaml
logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR
```

## Безопасность

⚠️ **Важно:**
- Не публикуйте `config.yaml` с вашими credentials
- Файл `config.yaml` уже добавлен в `.gitignore`
- Не делитесь файлами сессий (`sessions/*.session`)

## Решение проблем

### Ошибка авторизации
- Убедитесь, что API ID и API Hash правильные
- Удалите файл сессии и авторизуйтесь заново

### Канал не найден
- Проверьте, что у вас есть доступ к каналу
- Для приватных каналов убедитесь, что вы подписаны

### Ошибки загрузки
- Проверьте подключение к интернету
- Увеличьте `retry_attempts` и `retry_delay` в конфиге
- Проверьте логи в `logs/downloader.log`

### FloodWait ошибки
- Telegram ограничивает частоту запросов
- Бот автоматически ждет нужное время
- Можно уменьшить `max_concurrent` для снижения нагрузки

## Лицензия

Этот проект создан для личного использования.

## Поддержка

При возникновении проблем:
1. Проверьте логи в `logs/downloader.log`
2. Убедитесь, что конфигурация правильная
3. Проверьте доступ к каналам

